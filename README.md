## 1. System Overview

สร้างระบบ “เช่าของผ่าน LINE OA + LIFF” สำหรับให้ลูกค้าเช่ากล้อง (หรือสินค้าอื่น) โดย

* ลูกค้าใช้งานผ่าน **LINE OA + LIFF**
* แอดมินใช้งานผ่าน **เว็บหลังบ้าน (Back Office)**
* Notification ต่าง ๆ ส่งกลับไปที่ผู้เช่าผ่าน **LINE Messaging API**

Tech stack (ต้องการให้ AI ยึดตามนี้):

* Frontend (LIFF + Back Office): **Vue.js + Tailwind CSS v4**
* Backend API: **NestJS**
* ORM/Database: **Prisma 7**
* Runtime: **Node.js v20.19.0**
* Container: **แยก frontend / backend แต่ละส่วนรันด้วย Dockerfile**
* Database: ให้ AI เลือกที่เหมาะสม (เช่น PostgreSQL / MySQL) แต่ต้องต่อผ่าน Prisma

---

## 2. User Roles

1. **Customer (ผู้เช่า)**
   * ล็อกอินผ่าน LINE ONLY (LINE Login / LINE OAuth)
   * ใช้งานผ่าน LIFF เท่านั้น

2. **Admin (แอดมินหลังบ้าน)**
   * ล็อกอินผ่านระบบหลังบ้าน (email/password หรือ username/password)
   * กำหนดสิทธิ์ เช่น super admin / branch admin ได้

---

## 3. Customer Flow บน LINE LIFF

### 3.1 การเริ่มต้นใช้งาน

* ลูกค้าเพิ่ม **LINE OA** และกดเมนู/ปุ่ม **“เช่าเลย”**
* ระบบเปิด **LIFF** (Vue frontend)

### 3.2 LINE Login / Auth

* เมื่อเข้า LIFF ครั้งแรก ต้องทำ **LINE Login**
* Backend ต้องดึงข้อมูลจาก LINE:
  * LINE User ID
  * Display Name
  * Profile Picture URL
* Frontend แสดงชื่อและรูปโปรไฟล์ที่มาจาก LINE
* เก็บข้อมูลผู้ใช้ในฐานข้อมูล (ผูกด้วย LINE User ID)

### 3.3 Product Listing (หน้ารายการสินค้า)

* แสดง list ของสินค้าที่ “พร้อมให้เช่า” เช่น กล้องแต่ละรุ่น
* ข้อมูลที่ใช้แสดงใน Listing:
  * รูปภาพหลักของสินค้า
  * ชื่อสินค้า / รุ่น
  * ราคาต่อวันเริ่มต้น
  * สาขาที่ให้บริการ (ถ้ามีหลายสาขา)
  * สถานะโดยรวมว่า “ว่างสำหรับเช่า” หรือ “ถูกจองเต็มช่วงนี้”
* ต้องมี filter/search เบื้องต้น (เช่น เลือกสาขา, ราคาต่อวัน, ประเภทสินค้า)

### 3.4 Product Detail (หน้ารายละเอียดสินค้า)
เมื่อกดเข้าไปที่สินค้าจาก listing ให้แสดง:
* รูปภาพ (carousel ได้)
* รายละเอียดสินค้า
* ราคาเช่าต่อวัน
* เงื่อนไขเบื้องต้น (เช่น มัดจำ เท่าไร, เช่าขั้นต่ำกี่วัน)
* สาขาที่รองรับ
* ปุ่ม **“เลือกวันเช่า”** เพื่อเปิด calendar
### 3.5 Calendar & Availability (เลือกวันและเวลา)
* ปุ่มเปิด Calendar เพื่อเลือก:
  * **วันที่เริ่มเช่า + เวลาเริ่ม**
  * **วันที่คืน + เวลาคืน**
* Calendar ต้อง:
  * ดึงข้อมูล **วัน/ช่วงเวลาที่ว่าง** ของสินค้านั้นจาก Backend
  * บล็อกวันที่/เวลาที่ถูกจองแล้ว ไม่ให้ลูกค้าเลือก
* เมื่อเลือกช่วงเวลาแล้ว:
  * คำนวณ **จำนวนวัน/ชั่วโมงเช่า** (แล้วแต่ระบบ จะใช้เป็นวันเป็นหลัก)
  * คำนวณ **ราคารวมเบื้องต้น** = ราคาเช่าต่อวัน × จำนวนวันที่เช่า
### 3.6 Booking Form (ฟอร์มเช่าก่อนยืนยัน)
หลังจากเลือกวันและเวลาครบแล้ว ให้แสดงฟอร์ม:
**ฟิลด์ที่ต้องกรอก (แยกจากชื่อไลน์)**
1. ชื่อจริง
2. นามสกุล
3. เบอร์มือถือ
4. สาขารับของ (ถ้ามีหลายสาขา)
5. สถานที่นัดรับ (ถ้าใช้สถานที่อื่น)
   * เลือกจุดผ่าน Google Maps (เก็บ lat/long)
   * ช่องกรอกรายละเอียดที่อยู่/จุดนัดรับเพิ่มเติม
**Consent / Terms**
* มี checkbox ให้ติ๊กยอมรับเงื่อนไข เช่น:
  * ยอมรับเงื่อนไขการเช่า
  * ยอมรับให้เก็บข้อมูลส่วนตัวเพื่อการให้บริการ
* ปุ่ม **“ยืนยันเช่า”**
เมื่อกด “ยืนยันเช่า”:
* สร้าง **Rental Order** ใหม่ในระบบ (สถานะเริ่มต้น เช่น `PENDING_PAYMENT` หรือ `WAITING_PAYMENT`)
* เก็บข้อมูล:
  * ข้อมูลลูกค้า (จากฟอร์ม + จาก LINE)
  * ข้อมูลสินค้า
  * ช่วงวันที่เช่า
  * ราคาคำนวณ
  * สถานที่รับของ
  * สถานะคำขอเช่า
### 3.7 หน้าจอการโอนเงิน (ชำระเงินด้วยการโอน)
หลังจากสร้างออร์เดอร์แล้ว:
* พาไปหน้า **รายละเอียดการชำระเงิน** โดยแสดง:
  * ยอดที่ต้องโอน
  * ข้อมูลบัญชีธนาคาร (ชื่อบัญชี, เลขบัญชี, ธนาคาร, QR PromptPay ถ้ามี)
  * หมายเลขออร์เดอร์
  * ข้อความบอกให้ลูกค้าโอนเงินแล้วส่งสลิป
* (ออปชัน) ให้ลูกค้า **อัปโหลดสลิป** ผ่าน LIFF ก็ได้
  * ถ้าต้องการ ให้กำหนด requirement ว่าต้องมี API สำหรับอัปโหลดรูปสลิป ผูกกับออร์เดอร์
เมื่อเสร็จ ให้แสดงหน้า:
* สรุปรายการจอง
* สถานะปัจจุบัน (เช่น “รอตรวจสอบการชำระเงิน”)

---

## 4. การอัปเดตสถานะ & การแจ้งเตือนลูกค้าผ่าน LINE

### 4.1 สถานะของออร์เดอร์ (ตัวอย่าง)

ให้ AI ช่วยออกแบบ state machine ของออร์เดอร์ เช่น:

* `PENDING_PAYMENT` – ลูกค้าจองแล้ว ยังไม่โอน/ไม่ยืนยันสลิป
* `WAITING_CONFIRMATION` – ลูกค้าอัปโหลดสลิปแล้ว รอแอดมินตรวจ
* `APPROVED` – แอดมินตรวจสลิปแล้ว “อนุมัติ”
* `WAITING_DELIVERY` – สถานะกล้อง “รอส่ง / รอรับ”
* `IN_USE` – ลูกค้ารับของไปแล้ว กำลังเช่าอยู่
* `RETURNED` – คืนของครบแล้ว
* `CANCELLED` – ยกเลิก

### 4.2 การแจ้งเตือนผ่าน LINE

ทุกครั้งที่แอดมินอัปเดตสถานะในหลังบ้าน ให้ระบบ:
* เรียก LINE Messaging API ส่งข้อความไปหาลูกค้า (ตาม LINE User ID) แบบอัตโนมัติ เช่น:
  * เมื่อ `APPROVED` → ส่งข้อความแจ้งว่า “ออร์เดอร์ของคุณได้รับการอนุมัติ”
  * เมื่อ `WAITING_DELIVERY` → แจ้งรายละเอียดการนัดรับ
  * เมื่อใกล้วันคืน → ส่งข้อความเตือน (สามารถเป็น feature เสริม)

---

## 5. Back Office (Admin Panel) Requirements
Back office ทำด้วย Vue + Tailwind เช่นกัน แยกจาก LIFF (แต่ใช้ backend เดียวกัน)
### 5.1 Authentication
* ระบบล็อกอินแอดมิน (ไม่ใช้ LINE)
* Role-based Access (เช่น super admin, admin สาขา, staff)
### 5.2 Menu: Dashboard
* แสดงสรุปตัวเลขสำคัญ เช่น:
  * จำนวนออร์เดอร์วันนี้/เดือนนี้
  * รายได้รวมช่วงเวลาที่เลือก
  * จำนวนสินค้าที่ถูกเช่าอยู่ตอนนี้
  * Top product ที่ถูกเช่าบ่อย
* กราฟเบื้องต้น (AI ออกแบบเพิ่มได้)
### 5.3 Menu: Add Product / Manage Products

ฟีเจอร์:

* เพิ่มสินค้าใหม่
* แก้ไข / ลบ / ปิดการให้เช่า
* ฟิลด์สินค้า:
  * ชื่อสินค้า / รุ่น
  * รายละเอียด
  * ราคาเช่าต่อวัน
  * ค่ามัดจำ (ถ้ามี)
  * รูปภาพหลายรูป
  * สาขาที่สินค้าอยู่
  * สถานะสินค้าปกติ (เปิดให้เช่า / ปิด)
* ดูปฏิทินการจองของสินค้าตัวนั้น (รายการออร์เดอร์ที่จองไว้ในช่วงต่าง ๆ)

### 5.4 Menu: Add Branch / Manage Branch

ฟีเจอร์:

* สร้างสาขาใหม่
    * ชื่อสาขา
    * ที่อยู่
    * พิกัด (lat/long) สำหรับ map
    * เบอร์ติดต่อสาขา
  * แก้ไข / ปิดสาขา

### 5.5 Menu: Add User/Admin / Manage Users

ฟีเจอร์:
* เพิ่ม user/admin
  * ชื่อ
  * อีเมล / username
  * role (เช่น super admin, branch admin)
  * ผูกกับสาขา (กรณี branch admin)
* Reset password, ปิด/เปิดการใช้งาน account

### 5.6 Menu: View Customers / History Renter

* แสดง list ลูกค้าทั้งหมด (จากการเช่าจริงในระบบ)

* ข้อมูล:
  * ชื่อจริง–นามสกุล
  * LINE Display Name
  * เบอร์มือถือ
  * LINE User ID
* กดดูรายละเอียดคน ๆ นั้น:
  * ประวัติการเช่าทั้งหมด
  * ยอดใช้บริการรวม
  * สถานะการเช่าปัจจุบัน

### 5.7 Menu: Transaction History / Orders

* ตารางรายการออร์เดอร์ทั้งหมด
* Filter ตาม:
  * วันที่
  * สถานะออร์เดอร์
  * สินค้า
  * สาขา
* กดเข้าไปดูรายละเอียดออร์เดอร์:
  * ข้อมูลลูกค้า
  * สินค้า + ช่วงวันที่เช่า
  * ยอดเงิน
  * วิธีชำระ (transfer)
  * ข้อมูลสลิป (ถ้าให้ลูกค้าอัปโหลด)
  * Log การเปลี่ยนสถานะ
### 5.8 การยืนยันสลิป & อนุมัติ

* ในหน้ารายละเอียดออร์เดอร์ มีส่วนให้แอดมิน:
  * ดูรูปสลิป (ถ้ามีการอัปโหลด)
  * ปุ่ม “อนุมัติ” หรือ “ไม่อนุมัติ”
* เมื่อกดอนุมัติ:
  * เปลี่ยนสถานะออร์เดอร์ → `APPROVED`
  * พร้อมส่งข้อความไปที่ LINE ลูกค้าอัตโนมัติ

---

## 6. System & Integration Requirements

### 6.1 LINE Integration

* ใช้ LINE Login / LINE OAuth ใน LIFF เพื่อ:
  * ยืนยันตัวตนลูกค้า
  * ดึง Display Name + Profile Picture
* ใช้ LINE Messaging API:
  * ส่งข้อความแจ้งเตือนสถานะออร์เดอร์ไปยังลูกค้า
  * ใช้ LINE User ID จากตอน Login


### 6.2 API Design

* แยกเป็น REST API หรือ GraphQL (ให้ AI เลือก แต่ควรแนะนำ REST + NestJS)
* ทุกฟังก์ชันด้านบน (product, booking, order, customer, branch, admin, etc.) ต้องมี endpoint ครอบคลุม

### 6.3 Database & Prisma

Entities หลัก ๆ ที่ต้องมี (ให้ AI ออกแบบ schema detail):

* `User` (สำหรับ admin)
* `Customer` (ข้อมูลผู้เช่า + ผูกกับ LINE User ID)
* `Branch`
* `Product`
* `ProductImage`
* `RentalOrder`
* `RentalOrderStatusHistory`
* `Payment` หรือ `PaymentSlip`
* ฯลฯ (ให้ AI ออกแบบให้เหมาะสม)

---

## 7. สิ่งที่อยากเน้นให้ AI ทำเวลาใช้ Requirements นี้

* ออกแบบ **structure ของโปรเจกต์** (frontend/backend) ให้รองรับการรันด้วย Docker แยก service
* ออกแบบ **API spec**, **Prisma schema**, และ **โฟลว์ของสถานะออร์เดอร์** ให้ชัดเจน
* เตรียมโครง Vue + Tailwind v4 (ทั้ง LIFF และ back office) ให้พร้อมต่อยอด
* เขียนโค้ดตัวอย่างที่เชื่อมกับ LINE Login + LINE Messaging API (เวลาเราพร้อมให้เขียนโค้ด)